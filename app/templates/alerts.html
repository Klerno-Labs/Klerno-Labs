{% extends "base.html" %}
{% block content %}

<h1 class="text-2xl font-semibold mb-4">Alerts (≥ {{ threshold }})</h1>

{% if rows %}
  <div class="grid gap-4">
    {% for r in rows %}
      <div class="card p-4">
        <div class="flex items-center justify-between">
          <div class="font-semibold">{{ r.get('category') or 'unknown' }}</div>
          <div class="text-sm text-[var(--muted)]">{{ r.get('timestamp') }}</div>
        </div>

        <div class="mt-2 text-sm">
          <div><span class="text-[var(--muted)]">Tx:</span> {{ r.get('tx_id') }}</div>
          <div class="truncate"><span class="text-[var(--muted)]">From → To:</span> {{ r.get('from_addr') }} → {{ r.get('to_addr') }}</div>
          <div><span class="text-[var(--muted)]">Amount:</span> {{ r.get('amount') }} {{ r.get('symbol') or '' }}</div>
          <div>
            <span class="text-[var(--muted)]">Risk:</span>
            <span class="font-semibold text-[var(--danger)]">{{ "%.3f"|format(r.get('risk_score') or 0) }}</span>
          </div>
          {% set flags = r.get('risk_flags') or [] %}
          <div class="mt-2 flex flex-wrap gap-2">
            {% for f in flags %}
              <span class="chip px-2 py-0.5 rounded text-xs">{{ f }}</span>
            {% endfor %}
            {% if not flags %}<span class="text-[var(--muted)]">No flags</span>{% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="card p-6 text-[var(--muted)]">No alerts yet.</div>
{% endif %}

{% endblock %}
