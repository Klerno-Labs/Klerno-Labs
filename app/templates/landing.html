<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark"/>
  <meta name="theme-color" content="#7b6cff"/>
  <title>Klerno Labs ‚Äî AML Risk Intelligence & Compliance Automation</title>

  <!-- Enhanced SEO and social sharing -->
  <meta name="description" content="Klerno Labs builds AI-powered AML risk intelligence for XRPL & beyond: real-time transaction tagging, risk scoring, alerts, and explainable insights designed for compliance teams."/>
  <meta name="keywords" content="Klerno Labs, AML, compliance, risk intelligence, XRPL, crypto monitoring, transaction screening, blockchain analytics"/>
  <meta name="author" content="Klerno Labs"/>
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://klerno.com/"/>
  <meta property="og:title" content="Klerno Labs ‚Äî AML Risk Intelligence"/>
  <meta property="og:description" content="Real-time transaction tagging, risk scoring, alerts, and explainable insights for XRPL & beyond."/>
  <meta property="og:image" content="/static/klerno-social-preview.png"/>
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image"/>
  <meta property="twitter:url" content="https://klerno.com/"/>
  <meta property="twitter:title" content="Klerno Labs ‚Äî AML Risk Intelligence"/>
  <meta property="twitter:description" content="Real-time transaction tagging, risk scoring, alerts, and explainable insights for XRPL & beyond."/>
  <meta property="twitter:image" content="/static/klerno-social-preview.png"/>
  
  <!-- Preload critical resources -->
  <link rel="preload" href="/static/klerno-wordmark.png" as="image"/>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin/>

  <style>
    /* Enhanced design system with improved accessibility */
    :root{
      --bg:#060913; --ink:#f1f5f9; --muted:#cbd5e1; --secondary:#94a3b8;
      --accent:#7b6cff; --accent-2:#00e1ff; --accent-hover:#8a7aff;
      --glass:rgba(255,255,255,0.06); --stroke:rgba(255,255,255,0.12); 
      --glass-light:rgba(255,255,255,0.10); --glass-hover:rgba(255,255,255,0.14);
      --blur:16px; --transition:0.2s ease; --spring:cubic-bezier(0.68, -0.55, 0.265, 1.55);
      --shadow-sm:0 1px 2px rgba(0,0,0,0.1); --shadow-md:0 4px 12px rgba(0,0,0,0.15);
      --shadow-lg:0 10px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
      --space-xs:0.25rem; --space-sm:0.5rem; --space-md:1rem; --space-lg:1.5rem; --space-xl:2rem; --space-2xl:3rem;
    }
    
    /* Reset and base styles */
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    body{ 
      margin:0; 
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif; 
      color:var(--ink); 
      background:var(--bg); 
      overflow-x:hidden;
      line-height:1.6;
    }

    /* Skip to content for accessibility */
    .skip-to-content {
      position:absolute; top:-40px; left:6px; background:var(--accent); color:white; 
      padding:8px; text-decoration:none; border-radius:4px; z-index:100; transition:top 0.2s ease;
    }
    .skip-to-content:focus { top:6px; }

    /* Enhanced focus management */
    *:focus { outline:2px solid var(--accent); outline-offset:2px; }

    /* Animated background */
    canvas#bg{position:fixed; inset:0; width:100%; height:100%; display:block; z-index:0}
    .vignette{
      position:fixed; inset:0; z-index:1; pointer-events:none;
      background:radial-gradient(1200px 600px at 70% 20%,transparent 0%,rgba(0,0,0,.35) 70%,rgba(0,0,0,.7) 100%); 
      mix-blend-mode:multiply;
    }

    /* Enhanced top navigation */
    .topbar{
      position:sticky; top:0; z-index:3; display:flex; align-items:center; justify-content:space-between; 
      padding:var(--space-lg) var(--space-xl); background:linear-gradient(180deg, rgba(6,9,19,.85), rgba(6,9,19,.45)); 
      border-bottom:1px solid var(--stroke); backdrop-filter:blur(12px);
      transition:background var(--transition);
    }
    
    .brand-mini{
      display:flex; align-items:center; gap:var(--space-md); text-decoration:none; 
      color:var(--ink); transition:color var(--transition);
    }
    .brand-mini:hover { color:var(--accent); }
    .brand-mini img{
      height:28px; width:auto; display:block; 
      filter:drop-shadow(0 4px 16px rgba(123,108,255,.25));
      transition:filter var(--transition);
    }
    .brand-mini:hover img { filter:drop-shadow(0 6px 20px rgba(123,108,255,.4)); }
    
    .nav-actions{display:flex; gap:var(--space-md); align-items:center}
    
    /* Enhanced button system */
    .btn{ 
      display:inline-flex; align-items:center; gap:var(--space-sm); 
      padding:var(--space-md) var(--space-lg); border-radius:16px; 
      border:1px solid var(--stroke); background:var(--glass); color:var(--ink); 
      text-decoration:none; transition:all var(--transition) var(--spring); cursor:pointer; 
      font-weight:700; font-size:0.875rem; min-height:44px; position:relative; overflow:hidden;
    }
    
    .btn::before {
      content:''; position:absolute; inset:0; background:var(--glass-hover); 
      opacity:0; transition:opacity var(--transition);
    }
    .btn:hover::before { opacity:1; }
    .btn:hover{transform:translateY(-2px); border-color:var(--accent); color:var(--accent)}
    .btn:focus{outline:2px solid var(--accent); outline-offset:2px}
    .btn:active{transform:translateY(0)}
    
    .btn.primary{
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); 
      border-color:transparent; color:#0f172a; font-weight:800;
      box-shadow:0 4px 16px rgba(123,108,255,.25);
    }
    .btn.primary::before { 
      background:linear-gradient(135deg,var(--accent-hover),#1ae6ff); 
    }
    .btn.primary:hover{
      transform:translateY(-2px); box-shadow:0 8px 24px rgba(123,108,255,.4); 
      color:#0f172a;
    }
    
    /* Layout stack with improved spacing */
    .wrap{
      position:relative; z-index:2; min-height:100%; display:grid; place-items:start center; 
      padding:var(--space-xl) var(--space-lg);
    }
    .stack{width:100%; max-width:1200px; display:grid; gap:var(--space-xl)}

    /* Enhanced card system */
    .card{ 
      background:var(--glass); border:1px solid var(--stroke); border-radius:24px; 
      backdrop-filter:blur(var(--blur)); -webkit-backdrop-filter:blur(var(--blur)); 
      padding:var(--space-2xl); box-shadow:var(--shadow-lg); position:relative; overflow:hidden;
      transition:all var(--transition) var(--spring);
    }
    
    .card::before {
      content:''; position:absolute; top:0; left:0; right:0; height:2px;
      background:linear-gradient(90deg,var(--accent),var(--accent-2)); opacity:0.8;
    }
    
    .card:hover {
      transform:translateY(-4px); 
      box-shadow:0 20px 60px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.1);
      border-color:rgba(255,255,255,0.2);
    }

    /* BRAND CARD ‚Äì enhanced image presentation */
    .brand-card{ 
      padding:var(--space-2xl) var(--space-xl); display:grid; justify-items:center; 
      background:linear-gradient(180deg, var(--glass-light), var(--glass) 60%);
    }
    .brand-wordmark{ 
      max-width:min(500px,80%); height:auto; display:block; 
      filter:drop-shadow(0 8px 24px rgba(123,108,255,.25));
      transition:filter var(--transition);
    }
    .brand-card:hover .brand-wordmark {
      filter:drop-shadow(0 12px 32px rgba(123,108,255,.4));
    }

    /* Enhanced typography */
    .hero h1{ 
      margin:var(--space-sm) 0 var(--space-lg); 
      font-size:clamp(2rem,5vw,3.5rem); line-height:1.1; 
      letter-spacing:-0.02em; font-weight:800;
    }
    .grad{
      background:linear-gradient(135deg,#e2e8f0 0%,#a7f3ff 40%,#c7b8ff 80%); 
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    p.lead{
      margin:var(--space-md) 0 var(--space-xl); color:var(--muted); 
      font-size:clamp(1rem,2.2vw,1.25rem); line-height:1.6; font-weight:400;
    }
    .cta-row{
      display:flex; justify-content:center; gap:var(--space-md); margin-top:var(--space-lg);
      flex-wrap:wrap;
    }

    /* Enhanced pulse animation */
    .btn.primary.glow{ 
      animation:pulseGlow 3s infinite ease-in-out;
      box-shadow:0 4px 16px rgba(123,108,255,.25), 0 0 0 0 rgba(123,108,255,0);
    }
    @keyframes pulseGlow{
      0%,100%{box-shadow:0 4px 16px rgba(123,108,255,.25), 0 0 0 0 rgba(123,108,255,0)}
      50%{box-shadow:0 8px 24px rgba(123,108,255,.4), 0 0 0 15px rgba(123,108,255,0)}
    }

    /* Enhanced info panel */
    .info h2{
      margin:0 0 var(--space-lg); font-size:clamp(1.5rem,3.5vw,2.25rem); 
      letter-spacing:-0.01em; font-weight:700;
    }
    .info p{ 
      color:var(--muted); font-size:clamp(0.875rem,1.8vw,1.125rem); 
      line-height:1.7; margin:0 0 var(--space-lg);
    }
    
    .feature-list{ display:grid; gap:var(--space-lg); margin:var(--space-lg) 0 var(--space-xl) }
    .feature{ display:flex; gap:var(--space-md); align-items:flex-start; }
    .dot{ 
      width:12px; height:12px; border-radius:50%; 
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); 
      margin-top:8px; box-shadow:0 0 16px rgba(123,108,255,.5);
      flex-shrink:0;
    }
    .feature p { margin:0; }
    .feature strong { color:var(--ink); font-weight:700; }

    /* Enhanced preview gallery */
    .gallery{ 
      display:grid; gap:var(--space-lg); grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); 
      margin-top:var(--space-xl);
    }

    .preview-card{ 
      position:relative; border-radius:20px; border:1px solid var(--stroke); 
      background:linear-gradient(180deg, var(--glass-light), var(--glass)); 
      overflow:hidden; min-height:200px; transition:all var(--transition) var(--spring);
    }
    .preview-card:hover {
      transform:translateY(-4px); border-color:var(--accent); 
      box-shadow:var(--shadow-md);
    }
    
    .preview-empty{ 
      position:absolute; inset:0; display:grid; place-items:center; 
      color:var(--secondary); font-size:0.875rem; padding:var(--space-lg); 
      text-align:center; line-height:1.5;
    }
    
    .preview-cta{ 
      position:absolute; inset:auto var(--space-md) var(--space-md) auto; 
      padding:var(--space-sm) var(--space-md); border-radius:12px; 
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); 
      color:#0f172a; font-weight:700; font-size:0.75rem; border:0; cursor:pointer; 
      text-decoration:none; box-shadow:var(--shadow-sm); transition:all var(--transition);
      min-height:32px; display:flex; align-items:center;
    }
    .preview-cta:hover{ 
      transform:translateY(-1px); box-shadow:var(--shadow-md); 
      filter:brightness(1.1); color:#0f172a;
    }
    
    .preview-label{ 
      position:absolute; left:var(--space-md); bottom:var(--space-md); 
      color:var(--secondary); font-size:0.75rem; opacity:.9; 
      backdrop-filter:blur(6px); padding:var(--space-xs) var(--space-sm);
      background:rgba(0,0,0,0.3); border-radius:8px; font-weight:600;
      text-transform:uppercase; letter-spacing:0.05em;
    }

    /* iframe previews */
    .preview-frame{ width:100%; height:100%; border:0; display:block; pointer-events:none; background:transparent }

    /* mini chart canvas */
    .mini-chart{ width:100%; height:100%; display:block }
    
    /* Enhanced footer */
    footer{ 
      position:fixed; right:var(--space-lg); bottom:var(--space-md); z-index:2; 
      display:flex; justify-content:flex-end; align-items:center; 
      color:var(--secondary); font-size:0.75rem; opacity:.8; 
      background:rgba(6,9,19,0.8); padding:var(--space-sm) var(--space-md);
      border-radius:12px; backdrop-filter:blur(8px);
    }

    /* Enhanced responsive design */
    @media (max-width: 768px) {
      .topbar { padding:var(--space-md) var(--space-lg); }
      .wrap { padding:var(--space-lg) var(--space-md); }
      .stack { gap:var(--space-lg); }
      .card { padding:var(--space-xl); border-radius:20px; }
      .cta-row { flex-direction:column; align-items:center; }
      .btn { width:100%; max-width:300px; justify-content:center; }
      .gallery { grid-template-columns:1fr; gap:var(--space-md); }
      .feature-list { gap:var(--space-md); }
      .nav-actions { gap:var(--space-sm); }
      .nav-actions .btn { padding:var(--space-sm) var(--space-md); font-size:0.8rem; }
    }

    @media (max-width: 480px) {
      .topbar { padding:var(--space-md); }
      .brand-mini img { height:24px; }
      .card { padding:var(--space-lg); }
      .nav-actions { flex-direction:column; width:100%; }
      footer { position:relative; padding:var(--space-md); text-align:center; }
    }

    /* Accessibility enhancements */
    @media (prefers-reduced-motion: reduce) {
      *,*::before,*::after {
        animation-duration:0.01ms !important; animation-iteration-count:1 !important;
        transition-duration:0.01ms !important; scroll-behavior:auto !important;
      }
    }

    @media (prefers-contrast: high) {
      :root {
        --stroke:rgba(255,255,255,0.3); --muted:#e2e8f0; --secondary:#cbd5e1;
      }
    }

    /* Loading states */
    .loading { opacity:0.7; pointer-events:none; }
    .loading::after {
      content:''; width:16px; height:16px; border:2px solid currentColor;
      border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* Animation system */
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }
    .fade-in { animation:fadeIn 0.6s ease-out; }
  </style>
</head>
<body>
  <!-- Skip to content for accessibility -->
  <a href="#main-content" class="skip-to-content">Skip to main content</a>
  
  <canvas id="bg" aria-hidden="true"></canvas>
  <div class="vignette" aria-hidden="true"></div>

  <!-- Enhanced top navigation -->
  <header class="topbar" role="banner" aria-label="Primary navigation">
    <a class="brand-mini" href="/" aria-label="Klerno Labs home">
      <img src="/static/klerno-wordmark.png" alt="Klerno Labs" height="28" width="110"/>
    </a>
    <nav class="nav-actions" aria-label="Account actions">
      <a class="btn" href="/login" id="navLogin">Log in</a>
      <a class="btn" href="/signup" id="navSignup">Sign up</a>
      <a class="btn primary" href="/dashboard" id="navDashboard" style="display:none;">Dashboard</a>
      <a class="btn" href="/logout" id="navLogout" style="display:none;">Log out</a>
    </nav>
  </header>

  <div class="wrap">
    <main id="main-content" class="stack fade-in" role="main" tabindex="-1">
      <!-- Brand card: IMAGE ONLY -->
      <section class="card brand-card">
        <img class="brand-wordmark" src="/static/klerno-wordmark.png" alt="Klerno Labs wordmark" width="900" height="180" loading="eager" decoding="async"/>
      </section>

      <!-- Hero -->
      <section class="card hero" aria-labelledby="heroTitle">
        <h1 id="heroTitle"><span class="grad">AML Risk Intelligence</span> for XRPL &amp; beyond</h1>
        <p class="lead">Real-time transaction tagging, risk scoring, alerts, and explainable insights. Designed for compliance teams that want speed, clarity, and confidence.</p>
        <div class="cta-row">
          <!-- Single CTA -> /signup -->
          <a id="getApp" class="btn primary glow" href="/signup" aria-label="Get the Klerno Labs app">üöÄ Get the app</a>
        </div>
      </section>

      <!-- Info / conversion panel -->
      <section class="card info" aria-labelledby="infoTitle">
        <h2 id="infoTitle">Clarity at the speed of crypto.</h2>
        <p>Klerno Labs gives you a live, explainable view of on-chain activity‚Äîso you can move fast without missing red flags. No black boxes, no guesswork: just precise risk signals and crisp context your team can trust.</p>

        <div class="feature-list" role="list">
          <div class="feature" role="listitem"><span class="dot"></span><p><strong>Real-time tagging &amp; scoring</strong> across XRPL (and more soon), tuned for compliance operations.</p></div>
          <div class="feature" role="listitem"><span class="dot"></span><p><strong>Alerts with explanations</strong> so investigators get ‚Äúwhy‚Äù at a glance, not just a number.</p></div>
          <div class="feature" role="listitem"><span class="dot"></span><p><strong>Leadership-ready summaries</strong> that compress days of activity into a page of signal.</p></div>
        </div>

        <!-- LIVE previews -->
        <div class="gallery" aria-label="Preview gallery">
          <!-- 1) GRAPH from /metrics -->
          <div class="preview-card" id="prev-graph">
            <canvas id="metricsChart" class="mini-chart"></canvas>
            <div class="preview-empty">Save your API key to render a live risk trend.</div>
            <a class="preview-cta" id="graphOpen" target="_blank" rel="noopener" href="/dashboard">Open</a>
            <div class="preview-label">Avg risk (sparkline)</div>
          </div>

          <!-- 2) Risk drill-down (iframe) -->
          <div class="preview-card" data-target="/dashboard#risks" id="prev-risk">
            <iframe class="preview-frame" title="Risk drill-down preview" sandbox="allow-same-origin allow-scripts"></iframe>
            <div class="preview-empty">Live risk view loads after your API key is set.</div>
            <a class="preview-cta" target="_blank" rel="noopener">Open</a>
            <div class="preview-label">Risk drill-down</div>
          </div>

          <!-- 3) Alerts (iframe) -->
          <div class="preview-card" data-target="/alerts-ui" id="prev-alerts">
            <iframe class="preview-frame" title="Alerts preview" sandbox="allow-same-origin allow-scripts"></iframe>
            <div class="preview-empty">Alerts preview requires your API key.</div>
            <a class="preview-cta" target="_blank" rel="noopener">Open</a>
            <div class="preview-label">Alert details</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <footer>¬© <span id="yr"></span> Klerno Labs ‚Äî All rights reserved</footer>

  <script>
    // particles background (unchanged)
    const c = document.getElementById('bg'), ctx = c.getContext('2d');
    let W,H,DPR=Math.min(window.devicePixelRatio||1,2), P=[];
    const rnd=n=>Math.random()*n;
    function resize(){ W=c.width=Math.floor(innerWidth*DPR); H=c.height=Math.floor(innerHeight*DPR); c.style.width=innerWidth+'px'; c.style.height=innerHeight+'px'; const n=Math.floor((W*H)/(90_000*DPR)); P=Array.from({length:n},()=>({x:rnd(W),y:rnd(H),vx:(rnd(1)-.5)*.35,vy:(rnd(1)-.5)*.35})) }
    function step(){
      ctx.clearRect(0,0,W,H);
      const g=ctx.createLinearGradient(0,0,W,H); g.addColorStop(0,'rgba(123,108,255,.10)'); g.addColorStop(.5,'rgba(0,225,255,.08)'); g.addColorStop(1,'rgba(255,255,255,.05)');
      ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='rgba(255,255,255,.45)';
      for(const p of P){ p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>W)p.vx*=-1; if(p.y<0||p.y>H)p.vy*=-1; ctx.beginPath(); ctx.arc(p.x,p.y,1.3*DPR,0,Math.PI*2); ctx.fill() }
      ctx.strokeStyle='rgba(200,220,255,.11)';
      for(let i=0;i<P.length;i++){ const a=P[i]; for(let j=i+1;j<P.length;j++){ const b=P[j],dx=a.x-b.x,dy=a.y-b.y,d2=dx*dx+dy*dy; if(d2<18000*DPR){ ctx.globalAlpha=1-d2/(18000*DPR); ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke() } } }
      ctx.globalAlpha=1; requestAnimationFrame(step);
    }
    resize(); requestAnimationFrame(step); addEventListener('resize', resize);
    document.getElementById('yr').textContent = new Date().getFullYear();

    // ===== nav visibility based on session cookie =====
    (function(){
      const hasSession = document.cookie.split('; ').some(x => x.startsWith('session='));
      const byId = id => document.getElementById(id);
      if (hasSession) {
        byId('navLogin').style.display = 'none';
        byId('navSignup').style.display = 'none';
        byId('navDashboard').style.display = 'inline-flex';
        byId('navLogout').style.display = 'inline-flex';
      }
    })();

    // ===== Live preview wiring =====
    (function(){
      const key = (localStorage.getItem('cw_api_key') || '').trim();

      // Iframes (cards 2 & 3)
      document.querySelectorAll('.preview-card[data-target]').forEach(card => {
        const frame = card.querySelector('.preview-frame');
        const empty = card.querySelector('.preview-empty');
        const cta   = card.querySelector('.preview-cta');
        const base  = card.getAttribute('data-target') || '/';

        if (key) {
          const url = new URL(base, window.location.origin);
          url.searchParams.set('key', key);
          frame.src = url.toString();
          empty.style.display = 'none';
          cta.href = url.toString();
          cta.textContent = 'Open';
        } else {
          frame.removeAttribute('src');
          empty.style.display = 'grid';
          cta.href = '/paywall';
          cta.textContent = 'Add key';
        }
      });

      // Chart (card 1)
      const chartCard = document.getElementById('prev-graph');
      const empty = chartCard.querySelector('.preview-empty');
      const canvas = document.getElementById('metricsChart');
      const openBtn = document.getElementById('graphOpen');

      if (!key) {
        openBtn.href = '/paywall';
        openBtn.textContent = 'Add key';
        return;
      }

      fetch('/metrics', { headers: { 'x-api-key': key } })
        .then(r => r.ok ? r.json() : Promise.reject(r.statusText))
        .then(data => {
          empty.style.display = 'none';
          openBtn.href = new URL('/dashboard', window.location.origin).toString() + `?key=${encodeURIComponent(key)}`;
          openBtn.textContent = 'Open';

          const series = (data.series_by_day || []).slice(-30);
          drawSparkline(canvas, series.map(d => ({ x: new Date(d.date), y: +d.avg_risk || 0 })));
        })
        .catch(() => {
          empty.textContent = 'Could not load metrics (check API key).';
          openBtn.href = '/paywall';
          openBtn.textContent = 'Fix key';
        });

      function drawSparkline(cv, pts){
        const dpr = Math.min(window.devicePixelRatio||1,2);
        const w = chartCard.clientWidth, h = chartCard.clientHeight;
        cv.width = Math.floor(w*dpr); cv.height = Math.floor(h*dpr);
        cv.style.width = w+'px'; cv.style.height = h+'px';
        const ctx = cv.getContext('2d');
        ctx.scale(dpr,dpr);

        const pad = 16, top=14, bottom=24;
        const innerW = w - pad*2, innerH = h - top - bottom;
        if (!pts.length){ ctx.fillStyle='rgba(255,255,255,.45)'; ctx.fillText('No data', w/2-20, h/2); return; }

        const xs = pts.map(p=>p.x.getTime());
        const ys = pts.map(p=>p.y);
        const minX = Math.min(...xs), maxX = Math.max(...xs);
        const minY = Math.min(...ys, 0), maxY = Math.max(...ys, 1);

        const xScale = t => pad + ((t-minX)/(maxX-minX || 1)) * innerW;
        const yScale = v => top + innerH - ((v-minY)/(maxY-minY || 1)) * innerH;

        const grad = ctx.createLinearGradient(0, top, 0, top+innerH);
        grad.addColorStop(0, 'rgba(123,108,255,.45)');
        grad.addColorStop(1, 'rgba(123,108,255,0)');
        ctx.beginPath();
        ctx.moveTo(xScale(xs[0]), yScale(ys[0]));
        for (let i=1;i<pts.length;i++) ctx.lineTo(xScale(xs[i]), yScale(ys[i]));
        ctx.lineTo(xScale(xs[pts.length-1]), top+innerH);
        ctx.lineTo(xScale(xs[0]), top+innerH);
        ctx.closePath();
        ctx.fillStyle = grad;
        ctx.fill();

        ctx.beginPath();
        ctx.moveTo(xScale(xs[0]), yScale(ys[0]));
        for (let i=1;i<pts.length;i++) ctx.lineTo(xScale(xs[i]), yScale(ys[i]));
        ctx.strokeStyle = 'rgba(160,200,255,.9)';
        ctx.lineWidth = 2;
        ctx.stroke();

        const lx = xScale(xs[pts.length-1]), ly = yScale(ys[pts.length-1]);
        ctx.beginPath(); ctx.arc(lx, ly, 3, 0, Math.PI*2); ctx.fillStyle='#a7f3ff'; ctx.fill();
      }
    })();
  </script>
</body>
</html>
