{% extends "base.html" %}

{% block title %}Compliance Dashboard - Klerno Labs{% endblock %}

{% block head %}
<link rel="stylesheet" href="/static/css/design-system.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<style>
:root {
  --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  --glass-bg: rgba(255, 255, 255, 0.08);
  --glass-border: rgba(255, 255, 255, 0.12);
  --card-bg: rgba(255, 255, 255, 0.05);
  --card-border: rgba(255, 255, 255, 0.1);
  --text-primary: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.8);
  --text-tertiary: rgba(255, 255, 255, 0.6);
  --text-white: #ffffff;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --bg-light: var(--primary-gradient);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.2);
  --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.3);
  --border-radius: 12px;
  --border-radius-lg: 16px;
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  --spacing-2xl: 3rem;
}

* {
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--primary-gradient);
  margin: 0;
  line-height: 1.6;
  color: var(--text-primary);
  min-height: 100vh;
}

/* Professional Dashboard Header */
.dashboard-header {
  background: var(--primary-gradient);
  color: white;
  padding: 2rem 0;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
}

.dashboard-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
}

.header-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 2rem;
  position: relative;
  z-index: 2;
}

.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.header-brand {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.logo {
  width: 48px;
  height: 48px;
  background: white;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  font-weight: 700;
  color: #667eea;
}

.brand-text h1 {
  font-size: 1.5rem;
  font-weight: 700;
  margin: 0;
}

.brand-text p {
  font-size: 0.875rem;
  opacity: 0.8;
  margin: 0;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.user-menu {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 1rem;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 25px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.user-avatar {
  width: 32px;
  height: 32px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  color: #667eea;
  font-size: 0.875rem;
}

.header-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
}

.stat-item {
  text-align: center;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.stat-number {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  display: block;
}

.stat-label {
  font-size: 0.875rem;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Dashboard Content */
.dashboard-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 2rem;
}

.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 2rem;
  margin-bottom: 2rem;
}

.metric-card {
  background: white;
  border-radius: 20px;
  padding: 2rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  border: 1px solid #e5e7eb;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.metric-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--primary-gradient);
}

.metric-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.metric-icon {
  width: 56px;
  height: 56px;
  background: var(--primary-gradient);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  margin-bottom: 1.5rem;
  color: white;
}

.metric-value {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
  font-family: 'Inter', sans-serif;
}

.metric-label {
  color: var(--text-secondary);
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 1rem;
  font-weight: 600;
}

.metric-change {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  font-weight: 600;
}

.metric-change.positive {
  color: var(--success);
}

.metric-change.negative {
  color: var(--danger);
}

.metric-change.neutral {
  color: var(--text-secondary);
}

.chart-container {
  background: var(--glass-bg);
  backdrop-filter: var(--glass-backdrop);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-2xl);
  padding: var(--space-6);
  position: relative;
  overflow: hidden;
  transition: all var(--transition-base);
}

.chart-container:hover {
  border-color: var(--color-primary-200);
}

.chart-header {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-bottom: var(--space-6);
}

.chart-title {
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--color-text-primary);
  margin: 0;
}

.chart-controls {
  display: flex;
  gap: var(--space-2);
}

.chart-control-btn {
  padding: var(--space-2) var(--space-3);
  border: 1px solid var(--glass-border);
  background: var(--color-surface-secondary);
  color: var(--color-text-secondary);
  border-radius: var(--radius-lg);
  font-size: var(--text-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.chart-control-btn:hover,
.chart-control-btn.active {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
}

.quick-actions {
  background: var(--glass-bg);
  backdrop-filter: var(--glass-backdrop);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-2xl);
  padding: var(--space-6);
  margin-bottom: var(--space-8);
}

.action-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-4);
}

.action-btn {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-4);
  background: var(--color-surface-primary);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-xl);
  color: var(--color-text-primary);
  text-decoration: none;
  transition: all var(--transition-base);
  position: relative;
  overflow: hidden;
}

.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  border-color: var(--color-primary-200);
  color: var(--color-text-primary);
}

.action-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  transition: left 0.5s;
}

.action-btn:hover::before {
  left: 100%;
}

.action-icon {
  font-size: var(--text-lg);
}

.transactions-table {
  background: var(--glass-bg);
  backdrop-filter: var(--glass-backdrop);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-2xl);
  overflow: hidden;
  position: relative;
}

.table-header {
  background: var(--color-surface-secondary);
  padding: var(--space-4) var(--space-6);
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--glass-border);
}

.table-controls {
  display: flex;
  gap: var(--space-2);
  align-items: center;
}

.search-input {
  background: var(--color-surface-primary);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg);
  padding: var(--space-2) var(--space-3);
  color: var(--color-text-primary);
  font-size: var(--text-sm);
  width: 200px;
  transition: all var(--transition-fast);
}

.search-input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-primary-100);
}

.table-wrapper {
  overflow-x: auto;
  max-height: 400px;
}

.compliance-table {
  width: 100%;
  border-collapse: collapse;
}

.compliance-table th {
  background: var(--color-surface-secondary);
  color: var(--color-text-secondary);
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: var(--space-3) var(--space-4);
  text-align: left;
  position: sticky;
  top: 0;
  z-index: 1;
}

.compliance-table td {
  padding: var(--space-3) var(--space-4);
  border-bottom: 1px solid var(--glass-border);
  color: var(--color-text-primary);
  font-size: var(--text-sm);
}

.compliance-table tr:hover {
  background: var(--color-surface-primary);
}

.risk-badge {
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-base);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.risk-low {
  background: rgba(34, 197, 94, 0.1);
  color: var(--color-success);
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.risk-medium {
  background: rgba(251, 191, 36, 0.1);
  color: var(--color-warning);
  border: 1px solid rgba(251, 191, 36, 0.3);
}

.risk-high {
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-error);
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.category-chip {
  background: var(--color-primary-100);
  color: var(--color-primary);
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-full);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
}

.loading-skeleton {
  background: linear-gradient(90deg, var(--color-surface-primary) 25%, var(--color-surface-secondary) 50%, var(--color-surface-primary) 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s infinite;
  border-radius: var(--radius-lg);
  height: 20px;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.alert-badge {
  position: absolute;
  top: var(--space-2);
  right: var(--space-2);
  background: var(--color-error);
  color: white;
  border-radius: var(--radius-full);
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  animation: pulse 2s infinite;
}

.status-indicator {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-3);
  background: var(--color-surface-primary);
  border-radius: var(--radius-lg);
  font-size: var(--text-sm);
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--color-success);
  animation: pulse 2s infinite;
}

.status-dot.warning {
  background: var(--color-warning);
}

.status-dot.error {
  background: var(--color-error);
}

/* Chart.js custom styling */
.chart-canvas {
  max-height: 300px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
  
  .action-grid {
    grid-template-columns: 1fr;
  }
  
  .chart-controls {
    flex-wrap: wrap;
  }
  
  .table-header {
    flex-direction: column;
    gap: var(--space-3);
    align-items: stretch;
  }
  
  .search-input {
    width: 100%;
  }
}

/* Animation classes */
.animate-slide-in {
  animation: slideIn 0.6s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.animate-fade-in-up {
  animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Wallet Management Styles */
.wallet-management-section {
  margin: 2rem 0;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: var(--border-radius-lg);
  backdrop-filter: blur(20px);
  overflow: hidden;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem;
  border-bottom: 1px solid var(--card-border);
  background: rgba(255, 255, 255, 0.02);
}

.section-header h3 {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
}

.section-icon {
  width: 24px;
  height: 24px;
  color: #4facfe;
}

.add-wallet-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  background: var(--accent-gradient);
  color: white;
  border: none;
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-lg);
}

.add-wallet-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-xl);
}

.wallet-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1rem;
  padding: 1.5rem;
}

.wallet-card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.wallet-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  border-color: rgba(255, 255, 255, 0.2);
}

.wallet-card.empty {
  text-align: center;
  padding: 3rem 2rem;
  background: rgba(255, 255, 255, 0.02);
  border: 2px dashed var(--card-border);
}

.empty-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.6;
}

.wallet-card h4 {
  margin: 0 0 0.5rem 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-primary);
}

.wallet-card p {
  margin: 0 0 1.5rem 0;
  color: var(--text-secondary);
  font-size: 0.875rem;
  line-height: 1.5;
}

.empty-cta-btn {
  padding: 0.75rem 1.5rem;
  background: var(--primary-gradient);
  color: white;
  border: none;
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.empty-cta-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.wallet-address {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.wallet-icon {
  width: 32px;
  height: 32px;
  background: var(--accent-gradient);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
}

.wallet-info {
  flex: 1;
  min-width: 0;
}

.wallet-label {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.25rem;
}

.wallet-address-text {
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 0.8rem;
  color: var(--text-primary);
  word-break: break-all;
  background: rgba(255, 255, 255, 0.05);
  padding: 0.5rem;
  border-radius: 6px;
  border: 1px solid var(--card-border);
}

.wallet-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
}

.wallet-action-btn {
  flex: 1;
  padding: 0.5rem 0.75rem;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid var(--card-border);
  border-radius: 8px;
  color: var(--text-secondary);
  font-size: 0.75rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.wallet-action-btn:hover {
  background: rgba(255, 255, 255, 0.12);
  color: var(--text-primary);
}

.wallet-action-btn.danger:hover {
  background: rgba(239, 68, 68, 0.2);
  border-color: rgba(239, 68, 68, 0.3);
  color: #fecaca;
}

/* Wallet Modal Styles */
.wallet-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.wallet-modal.active {
  opacity: 1;
  visibility: visible;
}

.wallet-modal-content {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: var(--border-radius-lg);
  padding: 2rem;
  width: 90%;
  max-width: 500px;
  backdrop-filter: blur(20px);
  transform: scale(0.9) translateY(20px);
  transition: all 0.3s ease;
}

.wallet-modal.active .wallet-modal-content {
  transform: scale(1) translateY(0);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.modal-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
}

.modal-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 4px;
  transition: color 0.3s ease;
}

.modal-close:hover {
  color: var(--text-primary);
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-label {
  display: block;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
}

.form-input {
  width: 100%;
  padding: 0.875rem;
  background: var(--input-bg);
  border: 1px solid var(--card-border);
  border-radius: var(--border-radius);
  color: var(--text-primary);
  font-size: 0.875rem;
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: #4facfe;
  box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
}

.form-input.address {
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 0.8rem;
}

.modal-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

.modal-btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: var(--border-radius);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.modal-btn.primary {
  background: var(--accent-gradient);
  color: white;
}

.modal-btn.secondary {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-secondary);
  border: 1px solid var(--card-border);
}

.modal-btn:hover {
  transform: translateY(-1px);
}
</style>
{% endblock %}

{% block content %}
<!-- Professional Dashboard Header -->
<div class="dashboard-header">
  <div class="header-container">
    <div class="header-top">
      <div class="header-brand">
        <div class="logo">KL</div>
        <div class="brand-text">
          <h1>Compliance Dashboard</h1>
          <p>Real-time blockchain transaction monitoring</p>
        </div>
      </div>
      <div class="header-actions">
        <a href="/wallets" class="btn-elite btn-elite-secondary" style="margin-right: 1rem; padding: 0.5rem 1rem; font-size: 0.875rem; text-decoration: none;">
          <i class="fas fa-wallet" style="margin-right: 0.5rem;"></i>
          Manage Wallets
        </a>
        <div class="user-menu">
          <div class="user-avatar">{{ user.email[0].upper() if user and user.email else 'U' }}</div>
          <span>{{ user.email if user and user.email else 'User' }}</span>
          <a href="/logout" style="color: rgba(255,255,255,0.8); text-decoration: none; font-size: 0.875rem;">Logout</a>
        </div>
      </div>
    </div>
    
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-number" id="totalProcessed">--</span>
        <span class="stat-label">Transactions</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="alertsCount">--</span>
        <span class="stat-label">Active Alerts</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="avgRisk">--</span>
        <span class="stat-label">Avg Risk Score</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="volume24h">--</span>
        <span class="stat-label">24h Volume</span>
      </div>
    </div>
  </div>
</div>

<!-- Dashboard Content -->
<div class="dashboard-content">
  <!-- Key Metrics -->
  <div class="dashboard-grid">
    <div class="metric-card">
      <div class="metric-icon">⚡</div>
      <div class="metric-label">Transaction Processing</div>
      <div class="metric-value" id="processingRate">95.2%</div>
      <div class="metric-change positive">
        <span>↗</span>
        <span>+2.1% efficiency gain</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon">🛡️</div>
      <div class="metric-label">Security Status</div>
      <div class="metric-value">Secure</div>
      <div class="metric-change positive">
        <span>✓</span>
        <span>All systems operational</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon">📊</div>
      <div class="metric-label">Compliance Score</div>
      <div class="metric-value" id="complianceScore">98.7%</div>
      <div class="metric-change positive">
        <span>↗</span>
        <span>+0.3% improvement</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon">🌐</div>
      <div class="metric-label">Network Coverage</div>
      <div class="metric-value">12 Chains</div>
      <div class="metric-change neutral">
        <span>•</span>
        <span>Multi-blockchain support</span>
      </div>
    </div>
  </div>

  <!-- Wallet Management Section -->
  <div class="wallet-management-section">
    <div class="section-header">
      <h3>
        <svg class="section-icon" fill="currentColor" viewBox="0 0 20 20">
          <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
          <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd"/>
        </svg>
        Wallet Addresses
      </h3>
      <button class="add-wallet-btn" onclick="showAddWalletModal()">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
        </svg>
        Add Wallet
      </button>
    </div>

    <div class="wallet-grid" id="walletGrid">
      <!-- Wallet addresses will be loaded here -->
      <div class="wallet-card empty" id="emptyWalletState">
        <div class="empty-icon">👛</div>
        <h4>No Wallet Addresses</h4>
        <p>Add your first wallet address to start monitoring transactions and compliance.</p>
        <button class="empty-cta-btn" onclick="showAddWalletModal()">Add Your First Wallet</button>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-grid">
    <div class="chart-container">
      <div class="chart-header">
        <h3>Risk Analysis Trends</h3>
        <div class="chart-controls">
          <button class="chart-control-btn active" data-period="7d">7D</button>
          <button class="chart-control-btn" data-period="30d">30D</button>
          <button class="chart-control-btn" data-period="90d">90D</button>
        </div>
      </div>
      <div class="chart-body">
        <canvas id="riskChart"></canvas>
      </div>
    </div>

    <div class="chart-container">
      <div class="chart-header">
        <h3>Transaction Categories</h3>
      </div>
      <div class="chart-body">
        <canvas id="categoryChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Actions Panel -->
  <div class="actions-panel">
    <h3>Compliance Actions</h3>
    <div class="action-grid">
      <button class="action-btn primary" id="fetchXRPL">
        <div class="action-icon">🔗</div>
        <div class="action-content">
          <span class="action-title">Fetch XRPL Data</span>
          <span class="action-subtitle">Load latest transactions</span>
        </div>
      </button>
      
      <button class="action-btn secondary" id="analyzeSample">
        <div class="action-icon">🔍</div>
        <div class="action-content">
          <span class="action-title">AML Analysis</span>
          <span class="action-subtitle">Run compliance checks</span>
        </div>
      </button>
      
      <button class="action-btn secondary" id="exportData">
        <div class="action-icon">📊</div>
        <div class="action-content">
          <span class="action-title">Export Report</span>
          <span class="action-subtitle">Generate compliance report</span>
        </div>
      </button>
      
      <button class="action-btn secondary" id="btnLoadSample">
        <div class="action-icon">🧪</div>
        <div class="action-content">
          <span class="action-title">Demo Analysis</span>
          <span class="action-subtitle">Load sample data</span>
        </div>
      </button>
    </div>
  </div>

  <!-- Transactions Table -->
  <div class="transactions-section">
    <div class="section-header">
      <div>
        <h3>Recent Transactions</h3>
        <p>Real-time blockchain transaction monitoring and analysis</p>
      </div>
      <div class="table-controls">
        <input type="text" placeholder="Search transactions..." id="searchTransactions" class="search-input">
        <label class="filter-toggle">
          <input type="checkbox" id="onlyAlerts">
          <span>High-risk only</span>
        </label>
      </div>
    </div>
    
    <div class="table-container">
      <table class="transactions-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Transaction</th>
            <th>Amount</th>
            <th>Category</th>
            <th>Risk Score</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="transactionsBody">
          <tr class="empty-state">
            <td colspan="6">
              <div class="empty-content">
                <div class="empty-icon">📊</div>
                <div class="empty-title">No transactions found</div>
                <div class="empty-subtitle">Load sample data or fetch real-time data to get started</div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

  <!-- Metrics Grid -->
  <div class="dashboard-grid">
    <div class="metric-card animate-fade-in-up" style="animation-delay: 0.1s;">
      <div class="metric-icon">�</div>
      <div class="metric-label">Transactions Analyzed</div>
      <div class="metric-value" id="totalProcessed">--</div>
      <div class="metric-change positive">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M7 14l5-5 5 5"/>
        </svg>
        <span>+12.5% vs last week</span>
      </div>
    </div>

    <div class="metric-card animate-fade-in-up" style="animation-delay: 0.2s;">
      <div class="metric-icon">⚠️</div>
      <div class="metric-label">AML/KYC Alerts</div>
      <div class="metric-value" id="alertsCount">--</div>
      <div class="metric-change negative">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 10l-5 5-5-5"/>
        </svg>
        <span>+2 compliance alerts</span>
      </div>
    </div>

    <div class="metric-card animate-fade-in-up" style="animation-delay: 0.3s;">
      <div class="metric-icon">🛡️</div>
      <div class="metric-label">Risk Score (Avg)</div>
      <div class="metric-value" id="avgRisk">--</div>
      <div class="metric-change positive">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M7 14l5-5 5 5"/>
        </svg>
        <span>-0.05 improvement</span>
      </div>
    </div>

    <div class="metric-card animate-fade-in-up" style="animation-delay: 0.4s;">
      <div class="metric-icon">�</div>
      <div class="metric-label">Transaction Volume (24h)</div>
      <div class="metric-value" id="volume24h">--</div>
      <div class="metric-change positive">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M7 14l5-5 5 5"/>
        </svg>
        <span>+8.2% volume increase</span>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-6); margin-bottom: var(--space-8);">
    <div class="chart-container animate-fade-in-up" style="animation-delay: 0.5s;">
      <div class="chart-header">
        <h3 class="chart-title">Blockchain Risk Analysis</h3>
        <div class="chart-controls">
          <button class="chart-control-btn active" data-period="7d">7D</button>
          <button class="chart-control-btn" data-period="30d">30D</button>
          <button class="chart-control-btn" data-period="90d">90D</button>
        </div>
      </div>
      <canvas id="riskChart" class="chart-canvas"></canvas>
    </div>

    <div class="chart-container animate-fade-in-up" style="animation-delay: 0.6s;">
      <div class="chart-header">
        <h3 class="chart-title">Transaction Categories</h3>
      </div>
      <canvas id="categoryChart" class="chart-canvas"></canvas>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions animate-fade-in-up" style="animation-delay: 0.7s;">
    <h3 style="font-size: var(--text-lg); font-weight: var(--font-semibold); color: var(--color-text-primary); margin: 0 0 var(--space-4) 0;">
      Compliance Actions
    </h3>
    <div class="action-grid">
      <button class="action-btn" id="fetchXRPL">
        <span class="action-icon">🔗</span>
        <span>Fetch XRPL Data</span>
      </button>
      <button class="action-btn" id="analyzeSample">
        <span class="action-icon">🔍</span>
        <span>AML Analysis</span>
      </button>
      <button class="action-btn" id="exportData">
        <span class="action-icon">�</span>
        <span>Export Report</span>
      </button>
      <button class="action-btn" id="btnLoadSample">
        <span class="action-icon">�</span>
        <span>Demo Analysis</span>
      </button>
    </div>
  </div>

  <!-- Recent Transactions -->
  <div class="transactions-table animate-fade-in-up" style="animation-delay: 0.8s;">
    <div class="table-header">
      <h3 style="font-size: var(--text-lg); font-weight: var(--font-semibold); color: var(--color-text-primary); margin: 0;">
        Blockchain Transaction Analysis
      </h3>
      <div class="table-controls">
        <input type="text" class="search-input" placeholder="Search wallet addresses, tx hashes..." id="searchTransactions">
        <label style="display: flex; align-items: center; gap: var(--space-2); color: var(--color-text-secondary); font-size: var(--text-sm);">
          <input type="checkbox" id="onlyAlerts" style="accent-color: var(--color-primary);">
          High-risk only
        </label>
      </div>
    </div>
    <div class="table-wrapper">
      <table class="compliance-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>From → To</th>
            <th>Amount</th>
            <th>Category</th>
            <th>Risk</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="transactionsBody">
          <!-- Populated by JavaScript -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Wallet Management Modal -->
<div class="wallet-modal" id="walletModal">
  <div class="wallet-modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Add Wallet Address</h3>
      <button class="modal-close" onclick="hideAddWalletModal()">&times;</button>
    </div>
    
    <form id="addWalletForm" onsubmit="addWalletAddress(event)">
      <div class="form-group">
        <label for="walletAddress" class="form-label">Wallet Address</label>
        <input 
          type="text" 
          id="walletAddress" 
          name="walletAddress" 
          class="form-input address" 
          placeholder="Enter blockchain wallet address (Bitcoin, Ethereum, XRP, etc.)"
          required
        >
      </div>
      
      <div class="form-group">
        <label for="walletLabel" class="form-label">Label (Optional)</label>
        <input 
          type="text" 
          id="walletLabel" 
          name="walletLabel" 
          class="form-input" 
          placeholder="e.g., 'Main Wallet', 'Trading Account'"
        >
      </div>
      
      <div class="modal-actions">
        <button type="button" class="modal-btn secondary" onclick="hideAddWalletModal()">Cancel</button>
        <button type="submit" class="modal-btn primary">Add Wallet</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/js/theme-controller.js"></script>
<script>
// Blockchain Compliance Dashboard Controller
class BlockchainDashboard {
  constructor() {
    this.charts = {};
    this.data = {
      transactions: [],
      metrics: {},
      alerts: []
    };
    this.init();
  }

  init() {
    this.initCharts();
    this.bindEvents();
    this.loadData();
    this.startLiveUpdates();
    this.updateTimestamp();
  }

  initCharts() {
    // Risk Trends Chart
    const riskCtx = document.getElementById('riskChart').getContext('2d');
    this.charts.risk = new Chart(riskCtx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Average Risk Score',
          data: [],
          borderColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary'),
          backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary-100'),
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointBackgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary'),
          pointBorderColor: '#ffffff',
          pointBorderWidth: 2,
          pointRadius: 6,
          pointHoverRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          x: {
            grid: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--glass-border')
            },
            ticks: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--color-text-secondary')
            }
          },
          y: {
            grid: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--glass-border')
            },
            ticks: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--color-text-secondary')
            },
            beginAtZero: true,
            max: 1
          }
        },
        interaction: {
          intersect: false,
          mode: 'index'
        }
      }
    });

    // Category Distribution Chart
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    this.charts.category = new Chart(categoryCtx, {
      type: 'doughnut',
      data: {
        labels: [],
        datasets: [{
          data: [],
          backgroundColor: [
            'rgba(0, 212, 255, 0.8)',
            'rgba(124, 58, 237, 0.8)',
            'rgba(34, 197, 94, 0.8)',
            'rgba(251, 191, 36, 0.8)',
            'rgba(239, 68, 68, 0.8)'
          ],
          borderColor: [
            'rgba(0, 212, 255, 1)',
            'rgba(124, 58, 237, 1)',
            'rgba(34, 197, 94, 1)',
            'rgba(251, 191, 36, 1)',
            'rgba(239, 68, 68, 1)'
          ],
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--color-text-secondary'),
              padding: 20,
              usePointStyle: true
            }
          }
        },
        cutout: '60%'
      }
    });
  }

  bindEvents() {
    // Chart period controls
    document.querySelectorAll('.chart-control-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.chart-control-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        this.updateChartPeriod(e.target.dataset.period);
      });
    });

    // Quick actions
    document.getElementById('fetchXRPL')?.addEventListener('click', () => this.fetchXRPLData());
    document.getElementById('analyzeSample')?.addEventListener('click', () => this.analyzeSample());
    document.getElementById('exportData')?.addEventListener('click', () => this.exportData());
    document.getElementById('btnLoadSample')?.addEventListener('click', () => this.loadSampleData());

    // Table filters
    document.getElementById('searchTransactions')?.addEventListener('input', (e) => {
      this.filterTransactions(e.target.value);
    });
    
    document.getElementById('onlyAlerts')?.addEventListener('change', (e) => {
      this.toggleAlertsFilter(e.target.checked);
    });
  }

  async loadData() {
    try {
      // Load metrics
      const metricsResponse = await fetch('/metrics-ui?days=7', { credentials: 'include' });
      if (metricsResponse.ok) {
        this.data.metrics = await metricsResponse.json();
        this.updateMetrics();
      }

      // Load recent transactions
      const transactionsResponse = await fetch('/uiapi/recent?limit=50&only_alerts=false', { credentials: 'include' });
      if (transactionsResponse.ok) {
        this.data.transactions = await transactionsResponse.json();
        this.updateTransactionsTable();
        this.updateCharts();
      }
    } catch (error) {
      console.error('Error loading dashboard data:', error);
      this.showError('Failed to load dashboard data');
    }
  }

  updateMetrics() {
    const metrics = this.data.metrics;
    
    // Animate counter updates
    this.animateCounter('totalProcessed', metrics.total_processed || 0);
    this.animateCounter('alertsCount', metrics.alerts_count || 0);
    this.animateCounter('avgRisk', (metrics.average_risk || 0).toFixed(3));
    this.animateCounter('volume24h', this.formatCurrency(metrics.volume_24h || 0));
  }

  animateCounter(elementId, finalValue) {
    const element = document.getElementById(elementId);
    if (!element) return;

    const startValue = 0;
    const duration = 1000;
    const startTime = performance.now();

    const animate = (currentTime) => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      if (typeof finalValue === 'number') {
        const currentValue = Math.floor(startValue + (finalValue - startValue) * progress);
        element.textContent = currentValue.toLocaleString();
      } else {
        element.textContent = finalValue;
      }

      if (progress < 1) {
        requestAnimationFrame(animate);
      }
    };

    requestAnimationFrame(animate);
  }

  updateCharts() {
    // Update risk trends chart
    if (this.data.transactions.length > 0) {
      const riskData = this.processRiskTrendData(this.data.transactions);
      this.charts.risk.data.labels = riskData.labels;
      this.charts.risk.data.datasets[0].data = riskData.values;
      this.charts.risk.update('active');

      // Update category distribution chart
      const categoryData = this.processCategoryData(this.data.transactions);
      this.charts.category.data.labels = categoryData.labels;
      this.charts.category.data.datasets[0].data = categoryData.values;
      this.charts.category.update('active');
    }
  }

  processRiskTrendData(transactions) {
    // Group transactions by day and calculate average risk
    const dailyRisk = {};
    
    transactions.forEach(tx => {
      const date = new Date(tx.timestamp).toDateString();
      if (!dailyRisk[date]) {
        dailyRisk[date] = { total: 0, count: 0 };
      }
      dailyRisk[date].total += tx.risk_score || 0;
      dailyRisk[date].count++;
    });

    const labels = Object.keys(dailyRisk).slice(-7); // Last 7 days
    const values = labels.map(date => {
      const avg = dailyRisk[date].total / dailyRisk[date].count;
      return avg.toFixed(3);
    });

    return { labels, values };
  }

  processCategoryData(transactions) {
    const categories = {};
    
    transactions.forEach(tx => {
      const category = tx.category || 'Unknown';
      categories[category] = (categories[category] || 0) + 1;
    });

    const labels = Object.keys(categories);
    const values = Object.values(categories);

    return { labels, values };
  }

  updateTransactionsTable() {
    const tbody = document.getElementById('transactionsBody');
    if (!tbody) return;

    if (this.data.transactions.length === 0) {
      tbody.innerHTML = `
        <tr>
          <td colspan="6" style="text-align: center; padding: var(--space-8); color: var(--color-text-secondary);">
            <div style="font-size: var(--text-lg); margin-bottom: var(--space-2);">📊</div>
            <div>No transactions found</div>
            <div style="font-size: var(--text-sm); margin-top: var(--space-2);">Load sample data to get started</div>
          </td>
        </tr>
      `;
      return;
    }

    tbody.innerHTML = this.data.transactions.map(tx => `
      <tr class="animate-slide-in">
        <td>${this.formatTimestamp(tx.timestamp)}</td>
        <td>
          <div style="font-family: var(--font-mono); font-size: var(--text-xs);">
            ${this.formatAddress(tx.from_address)} →<br>
            ${this.formatAddress(tx.to_address)}
          </div>
        </td>
        <td>
          <div style="font-weight: var(--font-medium);">
            ${tx.amount || 0} ${tx.currency || 'XRP'}
          </div>
        </td>
        <td>
          <span class="category-chip">${tx.category || 'Unknown'}</span>
        </td>
        <td>
          <span class="risk-badge ${this.getRiskClass(tx.risk_score)}">
            ${(tx.risk_score || 0).toFixed(3)}
          </span>
        </td>
        <td>
          <button class="btn-elite btn-elite-secondary" style="padding: var(--space-1) var(--space-2); font-size: var(--text-xs);" onclick="dashboard.viewTransaction('${tx.tx_hash}')">
            View
          </button>
        </td>
      </tr>
    `).join('');
  }

  formatTimestamp(timestamp) {
    return new Date(timestamp).toLocaleString('en-US', {
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  formatAddress(address) {
    if (!address) return '--';
    return `${address.slice(0, 6)}...${address.slice(-4)}`;
  }

  formatCurrency(amount) {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      notation: 'compact'
    }).format(amount);
  }

  getRiskClass(riskScore) {
    if (riskScore < 0.3) return 'risk-low';
    if (riskScore < 0.7) return 'risk-medium';
    return 'risk-high';
  }

  // Action methods
  async fetchXRPLData() {
    this.showLoading('Fetching XRPL data...');
    try {
      const response = await fetch('/xrpl/fetch', {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' }
      });
      
      if (response.ok) {
        this.showSuccess('XRPL data fetched successfully');
        this.loadData(); // Refresh data
      } else {
        this.showError('Failed to fetch XRPL data');
      }
    } catch (error) {
      this.showError('Error fetching XRPL data');
    }
  }

  async loadSampleData() {
    this.showLoading('Loading sample data...');
    try {
      const response = await fetch('/api/data/seed', {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' }
      });
      
      if (response.ok) {
        const result = await response.json();
        this.showSuccess(`Loaded ${result.saved || 0} sample transactions`);
        this.loadData(); // Refresh data
      } else {
        this.showError('Failed to load sample data');
      }
    } catch (error) {
      this.showError('Error loading sample data');
    }
  }

  startLiveUpdates() {
    // Update timestamp every minute
    setInterval(() => {
      this.updateTimestamp();
    }, 60000);

    // Refresh data every 5 minutes
    setInterval(() => {
      this.loadData();
    }, 300000);
  }

  updateTimestamp() {
    const element = document.getElementById('lastUpdated');
    if (element) {
      element.textContent = new Date().toLocaleTimeString();
    }
  }

  // Utility methods
  showLoading(message) {
    this.showNotification(message, 'info');
  }

  showSuccess(message) {
    this.showNotification(message, 'success');
  }

  showError(message) {
    this.showNotification(message, 'error');
  }

  showNotification(message, type = 'info') {
    // Create toast notification
    const toast = document.createElement('div');
    toast.className = `toast-notification toast-${type}`;
    toast.style.cssText = `
      position: fixed;
      top: var(--space-6);
      right: var(--space-6);
      background: var(--glass-bg);
      backdrop-filter: var(--glass-backdrop);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-4);
      color: var(--color-text-primary);
      z-index: var(--z-toast);
      animation: slideInRight 0.3s ease-out;
      max-width: 300px;
    `;
    
    toast.innerHTML = `
      <div style="display: flex; align-items: center; gap: var(--space-2);">
        <div>${this.getNotificationIcon(type)}</div>
        <div>${message}</div>
      </div>
    `;
    
    document.body.appendChild(toast);
    
    // Auto remove after 4 seconds
    setTimeout(() => {
      toast.style.animation = 'slideOutRight 0.3s ease-in';
      setTimeout(() => toast.remove(), 300);
    }, 4000);
  }

  getNotificationIcon(type) {
    const icons = {
      info: 'ℹ️',
      success: '✅',
      error: '❌',
      warning: '⚠️'
    };
    return icons[type] || icons.info;
  }
}

// Initialize dashboard when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  window.dashboard = new EliteDashboard();
});

// Add CSS for toast animations
// Enhanced Blockchain Compliance Dashboard with Top 0.01% Functionality
class BlockchainDashboard {
  constructor() {
    this.charts = {};
    this.websocket = null;
    this.refreshInterval = null;
    this.currentPeriod = '7d';
    this.isLoading = false;
    this.data = {
      metrics: {},
      transactions: [],
      alerts: []
    };
    
    this.init();
  }

  async init() {
    try {
      await this.initializeCharts();
      await this.loadInitialData();
      this.setupEventListeners();
      this.setupWebSocket();
      this.setupAutoRefresh();
      this.setupKeyboardShortcuts();
      this.setupTooltips();
      console.log('Blockchain Compliance Dashboard initialized successfully');
    } catch (error) {
      console.error('Dashboard initialization failed:', error);
      this.showErrorMessage('Failed to initialize dashboard');
    }
  }

  async initializeCharts() {
    const chartConfigs = {
      risk: {
        elementId: 'riskTrendChart',
        type: 'line',
        config: {
          type: 'line',
          data: {
            labels: [],
            datasets: [{
              label: 'Risk Score',
              data: [],
              borderColor: 'rgb(239, 68, 68)',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointBackgroundColor: 'rgb(239, 68, 68)',
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              pointRadius: 6,
              pointHoverRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              intersect: false,
              mode: 'index'
            },
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: 'rgba(255, 255, 255, 0.2)',
                borderWidth: 1,
                cornerRadius: 8,
                displayColors: false,
                callbacks: {
                  title: function(context) {
                    return `Date: ${context[0].label}`;
                  },
                  label: function(context) {
                    return `Risk Score: ${(context.parsed.y * 100).toFixed(1)}%`;
                  }
                }
              }
            },
            scales: {
              x: {
                grid: {
                  display: false
                },
                ticks: {
                  color: 'rgba(255, 255, 255, 0.7)'
                }
              },
              y: {
                beginAtZero: true,
                max: 1,
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: 'rgba(255, 255, 255, 0.7)',
                  callback: function(value) {
                    return (value * 100).toFixed(0) + '%';
                  }
                }
              }
            },
            animation: {
              duration: 1000,
              easing: 'easeInOutQuart'
            }
          }
        }
      },
      category: {
        elementId: 'categoryChart',
        type: 'doughnut',
        config: {
          type: 'doughnut',
          data: {
            labels: [],
            datasets: [{
              data: [],
              backgroundColor: [
                'rgba(34, 197, 94, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(239, 68, 68, 0.8)',
                'rgba(99, 102, 241, 0.8)',
                'rgba(168, 85, 247, 0.8)'
              ],
              borderWidth: 0,
              hoverBorderWidth: 2,
              hoverBorderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: 'rgba(255, 255, 255, 0.8)',
                  padding: 20,
                  usePointStyle: true,
                  font: {
                    size: 12
                  }
                }
              },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: 'rgba(255, 255, 255, 0.2)',
                borderWidth: 1,
                cornerRadius: 8,
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed || 0;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${value} (${percentage}%)`;
                  }
                }
              }
            },
            animation: {
              animateRotate: true,
              duration: 1000
            },
            cutout: '60%'
          }
        }
      }
    };

    // Initialize charts
    for (const [key, config] of Object.entries(chartConfigs)) {
      const canvas = document.getElementById(config.elementId);
      if (canvas) {
        this.charts[key] = new Chart(canvas.getContext('2d'), config.config);
      }
    }
  }

  async loadInitialData() {
    this.showLoading();
    try {
      // Load metrics
      const metricsResponse = await fetch(`/metrics-ui?days=${this.getPeriodDays()}`);
      if (metricsResponse.ok) {
        this.data.metrics = await metricsResponse.json();
        this.updateMetrics();
      }

      // Load recent transactions
      const transactionsResponse = await fetch('/uiapi/recent?limit=50&only_alerts=false');
      if (transactionsResponse.ok) {
        this.data.transactions = await transactionsResponse.json();
        this.updateTransactionTable();
        this.updateCharts();
      }

      this.hideLoading();
    } catch (error) {
      console.error('Failed to load data:', error);
      this.showErrorMessage('Failed to load dashboard data');
      this.hideLoading();
    }
  }

  setupEventListeners() {
    // Period selection buttons
    document.querySelectorAll('.chart-control-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const period = e.target.dataset.period;
        if (period && period !== this.currentPeriod) {
          this.changePeriod(period);
        }
      });
    });

    // Refresh button
    const refreshBtn = document.querySelector('[data-action="refresh"]');
    if (refreshBtn) {
      refreshBtn.addEventListener('click', () => this.refreshData());
    }

    // Export button
    const exportBtn = document.querySelector('[data-action="export"]');
    if (exportBtn) {
      exportBtn.addEventListener('click', () => this.exportData());
    }

    // Search functionality
    const searchInput = document.querySelector('#transactionSearch');
    if (searchInput) {
      searchInput.addEventListener('input', (e) => this.searchTransactions(e.target.value));
    }

    // Settings button
    const settingsBtn = document.querySelector('[data-action="settings"]');
    if (settingsBtn) {
      settingsBtn.addEventListener('click', () => this.openSettings());
    }
  }

  setupWebSocket() {
    try {
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      const wsUrl = `${protocol}//${window.location.host}/ws/alerts`;
      
      this.websocket = new WebSocket(wsUrl);
      
      this.websocket.onopen = () => {
        console.log('WebSocket connected');
        this.showNotification('Real-time updates connected', 'success');
      };
      
      this.websocket.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          this.handleWebSocketMessage(data);
        } catch (error) {
          console.error('Failed to parse WebSocket message:', error);
        }
      };
      
      this.websocket.onclose = () => {
        console.log('WebSocket disconnected');
        this.showNotification('Real-time updates disconnected', 'warning');
        // Attempt to reconnect after 5 seconds
        setTimeout(() => this.setupWebSocket(), 5000);
      };
      
      this.websocket.onerror = (error) => {
        console.error('WebSocket error:', error);
      };
    } catch (error) {
      console.error('Failed to setup WebSocket:', error);
    }
  }

  setupAutoRefresh() {
    // Refresh data every 30 seconds
    this.refreshInterval = setInterval(() => {
      if (!this.isLoading) {
        this.refreshData(true); // Silent refresh
      }
    }, 30000);
  }

  setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
      // Ctrl/Cmd + R for refresh
      if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
        e.preventDefault();
        this.refreshData();
      }
      
      // Ctrl/Cmd + E for export
      if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
        e.preventDefault();
        this.exportData();
      }
      
      // Escape to close modals
      if (e.key === 'Escape') {
        this.closeAllModals();
      }
    });
  }

  setupTooltips() {
    // Initialize tooltips for metric cards
    document.querySelectorAll('[data-tooltip]').forEach(element => {
      element.addEventListener('mouseenter', (e) => {
        this.showTooltip(e.target, e.target.dataset.tooltip);
      });
      
      element.addEventListener('mouseleave', () => {
        this.hideTooltip();
      });
    });
  }

  async changePeriod(period) {
    // Update active button
    document.querySelectorAll('.chart-control-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.period === period);
    });
    
    this.currentPeriod = period;
    await this.loadInitialData();
  }

  getPeriodDays() {
    const periodMap = { '7d': 7, '30d': 30, '90d': 90 };
    return periodMap[this.currentPeriod] || 7;
  }

  async refreshData(silent = false) {
    if (this.isLoading) return;
    
    if (!silent) {
      this.showLoading();
      this.showNotification('Refreshing data...', 'info');
    }
    
    try {
      await this.loadInitialData();
      if (!silent) {
        this.showNotification('Data refreshed successfully', 'success');
      }
    } catch (error) {
      console.error('Refresh failed:', error);
      if (!silent) {
        this.showErrorMessage('Failed to refresh data');
      }
    }
  }

  updateMetrics() {
    const metrics = this.data.metrics;
    
    // Update metric cards with animation
    const metricCards = {
      'total-transactions': metrics.total || 0,
      'high-risk-alerts': metrics.alerts || 0,
      'average-risk': Math.round((metrics.avg_risk || 0) * 100) + '%'
    };
    
    Object.entries(metricCards).forEach(([id, value]) => {
      const element = document.getElementById(id);
      if (element) {
        this.animateValue(element, value);
      }
    });
  }

  updateCharts() {
    if (this.data.transactions.length > 0) {
      // Update risk trends chart
      const riskData = this.processRiskTrendData(this.data.transactions);
      this.charts.risk.data.labels = riskData.labels;
      this.charts.risk.data.datasets[0].data = riskData.values;
      this.charts.risk.update('active');

      // Update category distribution chart
      const categoryData = this.processCategoryData(this.data.transactions);
      this.charts.category.data.labels = categoryData.labels;
      this.charts.category.data.datasets[0].data = categoryData.values;
      this.charts.category.update('active');
    }
  }

  updateTransactionTable() {
    const tableBody = document.querySelector('#transactionTable tbody');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    this.data.transactions.slice(0, 10).forEach((tx, index) => {
      const row = this.createTransactionRow(tx, index);
      tableBody.appendChild(row);
    });
  }

  createTransactionRow(tx, index) {
    const row = document.createElement('tr');
    row.className = 'transaction-row';
    row.style.animationDelay = `${index * 50}ms`;
    
    const riskLevel = tx.risk_score > 0.7 ? 'high' : tx.risk_score > 0.4 ? 'medium' : 'low';
    const riskColor = { high: '#EF4444', medium: '#F59E0B', low: '#10B981' }[riskLevel];
    
    row.innerHTML = `
      <td class="transaction-hash">
        <code>${tx.hash || 'N/A'}</code>
      </td>
      <td class="transaction-amount">
        $${(tx.amount || 0).toLocaleString()}
      </td>
      <td class="transaction-risk">
        <span class="risk-badge" style="background: ${riskColor}20; color: ${riskColor};">
          ${Math.round((tx.risk_score || 0) * 100)}%
        </span>
      </td>
      <td class="transaction-category">
        ${tx.category || 'Unknown'}
      </td>
      <td class="transaction-time">
        ${this.formatTimestamp(tx.timestamp)}
      </td>
      <td class="transaction-actions">
        <button class="action-btn" onclick="dashboard.viewTransaction('${tx.hash}')" title="View Details">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
          </svg>
        </button>
      </td>
    `;
    
    return row;
  }

  processRiskTrendData(transactions) {
    const dailyRisk = {};
    
    transactions.forEach(tx => {
      const date = new Date(tx.timestamp).toDateString();
      if (!dailyRisk[date]) {
        dailyRisk[date] = { total: 0, count: 0 };
      }
      dailyRisk[date].total += tx.risk_score || 0;
      dailyRisk[date].count++;
    });

    const labels = Object.keys(dailyRisk).slice(-this.getPeriodDays());
    const values = labels.map(date => {
      const avg = dailyRisk[date].total / dailyRisk[date].count;
      return avg;
    });

    return { labels, values };
  }

  processCategoryData(transactions) {
    const categories = {};
    
    transactions.forEach(tx => {
      const category = tx.category || 'Unknown';
      categories[category] = (categories[category] || 0) + 1;
    });

    return {
      labels: Object.keys(categories),
      values: Object.values(categories)
    };
  }

  handleWebSocketMessage(data) {
    if (data.type === 'new_alert') {
      this.showNotification(`New ${data.risk_level} risk alert detected`, 'warning');
      this.addTransactionToTable(data.transaction);
    } else if (data.type === 'metrics_update') {
      this.data.metrics = data.metrics;
      this.updateMetrics();
    }
  }

  searchTransactions(query) {
    const rows = document.querySelectorAll('.transaction-row');
    
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      const matches = text.includes(query.toLowerCase());
      row.style.display = matches ? '' : 'none';
    });
  }

  async exportData() {
    try {
      this.showNotification('Preparing export...', 'info');
      
      const response = await fetch('/report/csv', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          days: this.getPeriodDays(),
          format: 'csv'
        })
      });
      
      if (response.ok) {
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `klerno-transactions-${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        this.showNotification('Export completed successfully', 'success');
      } else {
        throw new Error('Export failed');
      }
    } catch (error) {
      console.error('Export failed:', error);
      this.showErrorMessage('Failed to export data');
    }
  }

  viewTransaction(hash) {
    // Implementation for viewing transaction details
    console.log('Viewing transaction:', hash);
    this.showNotification(`Viewing transaction ${hash}`, 'info');
  }

  openSettings() {
    // Implementation for opening settings modal
    this.showNotification('Settings panel coming soon', 'info');
  }

  animateValue(element, value) {
    element.style.transform = 'scale(1.1)';
    element.style.transition = 'transform 0.2s ease';
    
    setTimeout(() => {
      element.textContent = value;
      element.style.transform = 'scale(1)';
    }, 100);
  }

  formatTimestamp(timestamp) {
    if (!timestamp) return 'N/A';
    const date = new Date(timestamp);
    return date.toLocaleString();
  }

  showLoading() {
    this.isLoading = true;
    const loader = document.querySelector('.loading-overlay');
    if (loader) {
      loader.style.display = 'flex';
    }
  }

  hideLoading() {
    this.isLoading = false;
    const loader = document.querySelector('.loading-overlay');
    if (loader) {
      loader.style.display = 'none';
    }
  }

  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    const container = document.querySelector('.notification-container') || document.body;
    container.appendChild(notification);
    
    // Animate in
    setTimeout(() => notification.classList.add('show'), 10);
    
    // Remove after 5 seconds
    setTimeout(() => {
      notification.classList.remove('show');
      setTimeout(() => container.removeChild(notification), 300);
    }, 5000);
  }

  showErrorMessage(message) {
    this.showNotification(message, 'error');
  }

  showTooltip(element, text) {
    const tooltip = document.createElement('div');
    tooltip.className = 'custom-tooltip';
    tooltip.textContent = text;
    document.body.appendChild(tooltip);
    
    const rect = element.getBoundingClientRect();
    tooltip.style.left = rect.left + rect.width / 2 + 'px';
    tooltip.style.top = rect.top - tooltip.offsetHeight - 10 + 'px';
  }

  hideTooltip() {
    const tooltip = document.querySelector('.custom-tooltip');
    if (tooltip) {
      tooltip.remove();
    }
  }

  closeAllModals() {
    document.querySelectorAll('.modal').forEach(modal => {
      modal.style.display = 'none';
    });
  }

  destroy() {
    if (this.websocket) {
      this.websocket.close();
    }
    if (this.refreshInterval) {
      clearInterval(this.refreshInterval);
    }
    Object.values(this.charts).forEach(chart => chart.destroy());
  }
}

// Initialize the blockchain compliance dashboard when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  window.dashboard = new BlockchainDashboard();
});

// Cleanup on page unload
window.addEventListener('beforeunload', function() {
  if (window.dashboard) {
    window.dashboard.destroy();
  }
});

// Add custom styles for notifications and enhanced UX
const style = document.createElement('style');
style.textContent = `
  @keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOutRight {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
  
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 24px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 10000;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
    max-width: 400px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  }
  
  .notification.show {
    opacity: 1;
    transform: translateX(0);
  }
  
  .notification-info { background: linear-gradient(135deg, #3B82F6, #1D4ED8); }
  .notification-success { background: linear-gradient(135deg, #10B981, #059669); }
  .notification-warning { background: linear-gradient(135deg, #F59E0B, #D97706); }
  .notification-error { background: linear-gradient(135deg, #EF4444, #DC2626); }
  
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }
  
  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  .transaction-row {
    animation: slideInUp 0.5s ease forwards;
    opacity: 0;
    transform: translateY(20px);
  }
  
  @keyframes slideInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .custom-tooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    pointer-events: none;
    z-index: 10000;
    transform: translateX(-50%);
  }
  
  .risk-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
  }
  
  .action-btn {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: all 0.3s ease;
  }
  
  .action-btn:hover {
    color: var(--color-primary);
    background: rgba(99, 102, 241, 0.1);
  }
`;
document.head.appendChild(style);

// Wallet Management Functions
let userWallets = [];

// Load user wallet addresses
async function loadUserWallets() {
  try {
    const response = await fetch('/api/user/wallets');
    const data = await response.json();
    userWallets = data.wallets || [];
    renderWalletGrid();
  } catch (error) {
    console.error('Error loading wallets:', error);
    userWallets = [];
    renderWalletGrid();
  }
}

// Render wallet grid
function renderWalletGrid() {
  const grid = document.getElementById('walletGrid');
  const emptyState = document.getElementById('emptyWalletState');
  
  if (userWallets.length === 0) {
    emptyState.style.display = 'block';
    return;
  }
  
  emptyState.style.display = 'none';
  
  // Create wallet cards
  const walletCards = userWallets.map(wallet => {
    const shortAddress = `${wallet.address.substring(0, 8)}...${wallet.address.substring(wallet.address.length - 6)}`;
    const chainIcon = detectChainIcon(wallet.address);
    
    return `
      <div class="wallet-card" data-wallet-id="${wallet.id || wallet.address}">
        <div class="wallet-address">
          <div class="wallet-icon">${chainIcon}</div>
          <div class="wallet-info">
            <div class="wallet-label">${wallet.label || detectChainType(wallet.address)}</div>
            <div class="wallet-address-text" title="${wallet.address}">${shortAddress}</div>
          </div>
        </div>
        <div class="wallet-actions">
          <button class="wallet-action-btn" onclick="copyWalletAddress('${wallet.address}')">
            Copy
          </button>
          <button class="wallet-action-btn" onclick="editWalletLabel('${wallet.address}', '${wallet.label || ''}')">
            Edit
          </button>
          <button class="wallet-action-btn danger" onclick="removeWalletAddress('${wallet.address}')">
            Remove
          </button>
        </div>
      </div>
    `;
  }).join('');
  
  grid.innerHTML = walletCards;
}

// Detect blockchain type from address
function detectChainType(address) {
  if (address.startsWith('bc1') || address.startsWith('1') || address.startsWith('3')) {
    return 'Bitcoin';
  } else if (address.startsWith('0x') && address.length === 42) {
    return 'Ethereum';
  } else if (address.startsWith('r') && address.length >= 25 && address.length <= 34) {
    return 'XRP';
  } else if (address.startsWith('bnb1') || (address.startsWith('0x') && address.length === 42)) {
    return 'Binance Smart Chain';
  }
  return 'Unknown Blockchain';
}

// Get chain icon
function detectChainIcon(address) {
  const chainType = detectChainType(address);
  const icons = {
    'Bitcoin': '₿',
    'Ethereum': 'Ξ',
    'XRP': '◈',
    'Binance Smart Chain': '⬡',
    'Unknown Blockchain': '🔗'
  };
  return icons[chainType] || '🔗';
}

// Show add wallet modal
function showAddWalletModal() {
  const modal = document.getElementById('walletModal');
  modal.classList.add('active');
  document.getElementById('walletAddress').focus();
}

// Hide add wallet modal
function hideAddWalletModal() {
  const modal = document.getElementById('walletModal');
  modal.classList.remove('active');
  document.getElementById('addWalletForm').reset();
}

// Add wallet address
async function addWalletAddress(event) {
  event.preventDefault();
  
  const form = event.target;
  const formData = new FormData(form);
  const walletAddress = formData.get('walletAddress').trim();
  const walletLabel = formData.get('walletLabel').trim();
  
  if (!walletAddress) {
    alert('Please enter a wallet address');
    return;
  }
  
  // Basic validation
  if (walletAddress.length < 20) {
    alert('Please enter a valid wallet address');
    return;
  }
  
  try {
    const response = await fetch('/api/user/wallets/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        address: walletAddress,
        label: walletLabel || null
      })
    });
    
    const result = await response.json();
    
    if (response.ok) {
      hideAddWalletModal();
      await loadUserWallets();
      showNotification('Wallet address added successfully!', 'success');
    } else {
      alert(result.detail || 'Failed to add wallet address');
    }
  } catch (error) {
    console.error('Error adding wallet:', error);
    alert('Failed to add wallet address');
  }
}

// Copy wallet address to clipboard
async function copyWalletAddress(address) {
  try {
    await navigator.clipboard.writeText(address);
    showNotification('Address copied to clipboard!', 'success');
  } catch (error) {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = address;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showNotification('Address copied to clipboard!', 'success');
  }
}

// Edit wallet label
async function editWalletLabel(address, currentLabel) {
  const newLabel = prompt('Enter new label for this wallet:', currentLabel);
  if (newLabel === null) return; // User cancelled
  
  try {
    const response = await fetch('/api/user/wallets/update', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        address: address,
        label: newLabel.trim() || null
      })
    });
    
    if (response.ok) {
      await loadUserWallets();
      showNotification('Wallet label updated!', 'success');
    } else {
      alert('Failed to update wallet label');
    }
  } catch (error) {
    console.error('Error updating wallet:', error);
    alert('Failed to update wallet label');
  }
}

// Remove wallet address
async function removeWalletAddress(address) {
  if (!confirm('Are you sure you want to remove this wallet address?')) {
    return;
  }
  
  try {
    const response = await fetch('/api/user/wallets/remove', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        address: address
      })
    });
    
    if (response.ok) {
      await loadUserWallets();
      showNotification('Wallet address removed!', 'success');
    } else {
      alert('Failed to remove wallet address');
    }
  } catch (error) {
    console.error('Error removing wallet:', error);
    alert('Failed to remove wallet address');
  }
}

// Show notification
function showNotification(message, type = 'info') {
  // Create notification element
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <div class="notification-content">
      <span class="notification-icon">
        ${type === 'success' ? '✓' : type === 'error' ? '✗' : 'ℹ'}
      </span>
      <span class="notification-message">${message}</span>
    </div>
  `;
  
  // Add styles
  notification.style.cssText = `
    position: fixed;
    top: 2rem;
    right: 2rem;
    z-index: 2000;
    background: ${type === 'success' ? 'rgba(16, 185, 129, 0.9)' : type === 'error' ? 'rgba(239, 68, 68, 0.9)' : 'rgba(59, 130, 246, 0.9)'};
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    backdrop-filter: blur(20px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    transform: translateX(400px);
    transition: all 0.3s ease;
    max-width: 400px;
  `;
  
  document.body.appendChild(notification);
  
  // Animate in
  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.transform = 'translateX(400px)';
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 300);
  }, 3000);
}

// Close modal when clicking outside
document.getElementById('walletModal').addEventListener('click', function(event) {
  if (event.target === this) {
    hideAddWalletModal();
  }
});

// Initialize wallet management when dashboard loads
document.addEventListener('DOMContentLoaded', function() {
  loadUserWallets();
});

</script>
{% endblock %}