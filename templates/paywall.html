<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=devi      <!-- Paywall form -->
      <section class=" card" <div class="row">
  <button class="btn" type="submit">ðŸš€ Continue to app</button>
  </div>

  <div class="muted">
    Don't have a code yet? <a href="/" style="color:#bfe2ff; text-decoration:none">Back to home</a>
  </div>
  </form>

  <hr style="margin: 30px 0; border: 0; border-top: 1px solid var(--stroke);">

  <h2>Or Subscribe with XRP</h2>
  <p class="lead">Choose a subscription tier to unlock full access with XRP payment.</p>

  <div id="subscription-tiers" style="margin-bottom: 20px;">
    <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 20px;">
      <div class="tier-card active" data-tier="1">
        <h3 style="margin: 0 0 8px;">Basic</h3>
        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">10 XRP</div>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 14px;">
          <li>Basic analysis tools</li>
          <li>100 transactions/month</li>
          <li>Email support</li>
        </ul>
      </div>
      <div class="tier-card" data-tier="2">
        <h3 style="margin: 0 0 8px;">Premium</h3>
        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">25 XRP</div>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 14px;">
          <li>All analysis tools</li>
          <li>Unlimited transactions</li>
          <li>Priority support</li>
          <li>API access</li>
        </ul>
      </div>
      <div class="tier-card" data-tier="3">
        <h3 style="margin: 0 0 8px;">Enterprise</h3>
        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">50 XRP</div>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 14px;">
          <li>All Premium features</li>
          <li>Dedicated support</li>
          <li>Custom integrations</li>
          <li>Multi-user access</li>
        </ul>
      </div>
    </div>
  </div>

  <div id="payment-flow">
    <div id="step-1">
      <div class="row">
        <button id="create-payment-btn" class="btn" type="button">ðŸš€ Create Payment Request</button>
      </div>
    </div>

    <div id="step-2" style="display: none;">
      <div style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
        <h3 style="margin: 0 0 12px;">Payment Instructions</h3>
        <div id="payment-details"
          style="font-family: monospace; font-size: 14px; margin-bottom: 16px; word-break: break-all;">
          <div><strong>To Address:</strong> <span id="destination-address"></span></div>
          <div><strong>Amount:</strong> <span id="payment-amount"></span> XRP</div>
          <div><strong>Destination Tag:</strong> <span id="destination-tag"></span> (REQUIRED)</div>
        </div>
        <div class="muted" style="text-align: left; margin-bottom: 8px;">
          1. Send the exact amount to the address above using your XRP wallet
        </div>
        <div class="muted" style="text-align: left; margin-bottom: 8px;">
          2. Include the destination tag when sending your payment
        </div>
        <div class="muted" style="text-align: left;">
          3. After sending, enter your transaction hash below to verify
        </div>
      </div>

      <div>
        <label for="tx-hash">XRP Transaction Hash</label>
        <input id="tx-hash" type="text" placeholder="Enter the transaction hash" required />
      </div>

      <div class="row" style="margin-top: 16px;">
        <button id="verify-payment-btn" class="btn" type="button">âœ… Verify Payment</button>
        <button id="back-btn" style="background: transparent; color: var(--muted); border: 1px solid var(--stroke);"
          class="btn" type="button">Back</button>
      </div>
    </div>

    <div id="step-3" style="display: none;">
      <div id="success-message"
        style="display: none; background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); border-radius: 12px; padding: 16px; margin-bottom: 16px; color: var(--ok);">
        <h3 style="margin: 0 0 12px;">Payment Verified!</h3>
        <p style="margin: 0;">Your subscription has been activated successfully.</p>
      </div>

      <div id="error-message"
        style="display: none; background: rgba(255,107,107,0.1); border: 1px solid rgba(255,107,107,0.3); border-radius: 12px; padding: 16px; margin-bottom: 16px; color: var(--danger);">
        <h3 style="margin: 0 0 12px;">Payment Verification Failed</h3>
        <p id="error-details" style="margin: 0;"></p>
      </div>

      <div class="row">
        <a href="/dashboard" class="btn" id="continue-btn" style="display: none;">Continue to Dashboard</a>
        <button id="try-again-btn" class="btn"
          style="display: none; background: transparent; color: var(--muted); border: 1px solid var(--stroke);"
          type="button">Try Again</button>
      </div>
    </div>
  </div>
  </section>
  <h2>Subscribe with XRP</h2>
  <p class="lead">Choose a subscription tier to unlock full access to Klerno Labs.</p>

  {% if error %}
  <div class="error">{{ error }}</div>
  {% endif %}

  <div id="subscription-tiers" style="margin-bottom: 20px;">
    <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 20px;">
      <div class="tier-card active" data-tier="1">
        <h3 style="margin: 0 0 8px;">Basic</h3>
        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">10 XRP</div>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 14px;">
          <li>Basic analysis tools</li>
          <li>100 transactions/month</li>
          <li>Email support</li>
        </ul>
      </div>
      <div class="tier-card" data-tier="2">
        <h3 style="margin: 0 0 8px;">Premium</h3>
        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">25 XRP</div>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 14px;">
          <li>All analysis tools</li>
          <li>Unlimited transactions</li>
          <li>Priority support</li>
          <li>API access</li>
        </ul>
      </div>
      <div class="tier-card" data-tier="3">
        <h3 style="margin: 0 0 8px;">Enterprise</h3>
        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">50 XRP</div>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 14px;">
          <li>All Premium features</li>
          <li>Dedicated support</li>
          <li>Custom integrations</li>
          <li>Multi-user access</li>
        </ul>
      </div>
    </div>
  </div>-scale=1"/>
  <title>Klerno Labs â€” Access</title>
  <style>
    :root {
      --bg: #060913;
      --ink: #eaf0ff;
      --muted: #9fb0d3;
      --accent: #7b6cff;
      --accent-2: #00e1ff;
      --glass: rgba(255, 255, 255, 0.06);
      --stroke: rgba(255, 255, 255, 0.12);
      --blur: 14px;
      --danger: #ff6b6b;
      --ok: #22c55e;
    }

    --glass:rgba(255, 255, 255, 0.06);
    --stroke:rgba(255, 255, 255, 0.12);
    --blur:14px;
    --danger:#ff6b6b;
    --ok:#22c55e;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: var(--bg);
      overflow: hidden
    }

    /* background */
    canvas#bg {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      z-index: 0
    }

    .vignette {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      background: radial-gradient(1200px 600px at 70% 20%, transparent 0%, rgba(0, 0, 0, .35) 70%, rgba(0, 0, 0, .7) 100%);
      mix-blend-mode: multiply
    }

    /* layout */
    .wrap {
      position: relative;
      z-index: 2;
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 24px
    }

    .stack {
      width: 100%;
      max-width: 640px;
      display: grid;
      gap: 22px
    }

    /* card */
    .card {
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 20px;
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      padding: 28px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, .35), inset 0 1px 0 rgba(255, 255, 255, .05);
    }

    /* brand card */
    .brand-card {
      text-align: center;
      padding: 34px 28px
    }

    .brand-title {
      margin: 0;
      font-weight: 800;
      letter-spacing: -.02em;
      font-size: clamp(40px, 7vw, 80px);
      line-height: 1.05;
      background: linear-gradient(90deg, #eaf0ff, #a7f3ff 40%, #c7b8ff 80%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .brand-sub {
      margin-top: 8px;
      color: var(--muted);
      font-size: clamp(13px, 1.6vw, 16px)
    }

    /* form */
    h2 {
      margin: 6px 0 6px;
      font-size: clamp(22px, 3.5vw, 30px);
      letter-spacing: -.01em
    }

    p.lead {
      margin: 0 0 16px;
      color: var(--muted)
    }

    .form {
      display: grid;
      gap: 14px;
      margin-top: 6px
    }

    label {
      color: var(--muted);
      font-size: 14px
    }

    input[type="password"],
    input[type="text"] {
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid var(--stroke);
      background: rgba(255, 255, 255, .06);
      color: var(--ink);
      outline: none;
    }

    .row {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 16px 24px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #020617;
      font-weight: 700;
      text-decoration: none;
      cursor: pointer;
      transition: transform .12s ease, filter .12s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05)
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
      text-align: center
    }

    .error {
      margin-top: 4px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 107, 107, .35);
      background: rgba(255, 107, 107, .08);
      color: #ffd6d6;
      font-size: 14px;
    }

    /* tier cards */
    .tier-card {
      flex: 1;
      min-width: 140px;
      border: 1px solid var(--stroke);
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tier-card.active {
      border-color: var(--accent);
      background: rgba(123, 108, 255, 0.1);
    }

    .tier-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    footer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 10px;
      z-index: 2;
      display: grid;
      place-items: center;
      color: var(--muted);
      font-size: 12px;
      opacity: .8
    }
  </style>
</head>

<body>
  <canvas id="bg"></canvas>
  <div class="vignette"></div>

  <div class="wrap">
    <div class="stack">
      <!-- Brand header -->
      <section class="card brand-card">
        <h1 class="brand-title">Klerno Labs</h1>
        <div class="brand-sub">Secure access to the in-app dashboard</div>
      </section>

      <!-- Paywall form -->
      <section class="card">
        <h2>Enter access code</h2>
        <p class="lead">Use the code you received after subscribing to unlock the app.</p>

        {% if error %}
        <div class="error">That code didnâ€™t match. Please try again.</div>
        {% endif %}

        <form class="form" action="/paywall/verify" method="post" autocomplete="off">
          <div>
            <label for="code">Access code</label>
            <input id="code" name="code" type="password" placeholder="Enter your code" required />
          </div>

          <div class="row">
            <button class="btn" type="submit">ðŸš€ Continue to app</button>
          </div>

          <div class="muted">
            Donâ€™t have a code yet? <a href="/" style="color:#bfe2ff; text-decoration:none">Back to home</a>
          </div>
        </form>
      </section>
    </div>
  </div>

  <footer>Â© <span id="yr"></span> Klerno Labs â€” All rights reserved</footer>

  <script>
    // particles background (same as landing)
    const c = document.getElementById('bg'), ctx = c.getContext('2d');
    let W, H, DPR = Math.min(window.devicePixelRatio || 1, 2), P = [];
    const rnd = n => Math.random() * n;
    function resize() {
      W = c.width = Math.floor(innerWidth * DPR); H = c.height = Math.floor(innerHeight * DPR);
      c.style.width = innerWidth + 'px'; c.style.height = innerHeight + 'px';
      const n = Math.floor((W * H) / (90_000 * DPR));
      P = Array.from({ length: n }, () => ({ x: rnd(W), y: rnd(H), vx: (rnd(1) - .5) * .35, vy: (rnd(1) - .5) * .35 }));
    }
    function step() {
      ctx.clearRect(0, 0, W, H);
      const g = ctx.createLinearGradient(0, 0, W, H);
      g.addColorStop(0, 'rgba(123,108,255,.10)'); g.addColorStop(.5, 'rgba(0,225,255,.08)'); g.addColorStop(1, 'rgba(255,255,255,.05)');
      ctx.fillStyle = g; ctx.fillRect(0, 0, W, H);
      ctx.fillStyle = 'rgba(255,255,255,.45)';
      for (const p of P) {
        p.x += p.vx; p.y += p.vy; if (p.x < 0 || p.x > W) p.vx *= -1; if (p.y < 0 || p.y > H) p.vy *= -1;
        ctx.beginPath(); ctx.arc(p.x, p.y, 1.3 * DPR, 0, Math.PI * 2); ctx.fill();
      }
      ctx.strokeStyle = 'rgba(200,220,255,.11)';
      for (let i = 0; i < P.length; i++) {
        const a = P[i];
        for (let j = i + 1; j < P.length; j++) {
          const b = P[j], dx = a.x - b.x, dy = a.y - b.y, d2 = dx * dx + dy * dy;
          if (d2 < 18000 * DPR) {
            ctx.globalAlpha = 1 - d2 / (18000 * DPR);
            ctx.beginPath(); ctx.moveTo(a.x, a.y); ctx.lineTo(b.x, b.y); ctx.stroke();
          }
        }
      }
      ctx.globalAlpha = 1; requestAnimationFrame(step);
    }
    resize(); requestAnimationFrame(step); addEventListener('resize', resize);
    document.getElementById('yr').textContent = new Date().getFullYear();

    // XRPL Payment Flow
    document.addEventListener('DOMContentLoaded', function () {
      // Variables
      let selectedTier = 1;
      let paymentRequest = null;

      // Select elements
      const tierCards = document.querySelectorAll('.tier-card');
      const createPaymentBtn = document.getElementById('create-payment-btn');
      const verifyPaymentBtn = document.getElementById('verify-payment-btn');
      const backBtn = document.getElementById('back-btn');
      const tryAgainBtn = document.getElementById('try-again-btn');
      const txHashInput = document.getElementById('tx-hash');

      // Steps
      const step1 = document.getElementById('step-1');
      const step2 = document.getElementById('step-2');
      const step3 = document.getElementById('step-3');

      // Select tier
      tierCards.forEach(card => {
        card.addEventListener('click', function () {
          // Remove active class from all cards
          tierCards.forEach(c => c.classList.remove('active'));
          // Add active class to clicked card
          this.classList.add('active');
          // Update selected tier
          selectedTier = parseInt(this.dataset.tier);
        });
      });

      // Create payment request
      createPaymentBtn.addEventListener('click', function () {
        // Show loading state
        this.textContent = 'Creating...';
        this.disabled = true;

        // Call API to create payment request
        fetch(`/api/paywall/xrp-payment`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ amount_xrp: selectedTier === 1 ? 10 : selectedTier === 2 ? 25 : 50 })
        })
          .then(response => response.json())
          .then(data => {
            // Save payment request
            paymentRequest = data.payment_request;

            // Fill payment details
            document.getElementById('destination-address').textContent = paymentRequest.destination_address;
            document.getElementById('payment-amount').textContent = paymentRequest.amount_xrp;
            document.getElementById('destination-tag').textContent = paymentRequest.destination_tag;

            // Show step 2
            step1.style.display = 'none';
            step2.style.display = 'block';
          })
          .catch(error => {
            console.error('Error creating payment request:', error);
            this.textContent = 'Create Payment Request';
            this.disabled = false;
            alert('Error creating payment request. Please try again.');
          });
      });

      // Verify payment
      verifyPaymentBtn.addEventListener('click', function () {
        const txHash = txHashInput.value.trim();
        if (!txHash) {
          alert('Please enter a transaction hash');
          return;
        }

        // Show loading state
        this.textContent = 'Verifying...';
        this.disabled = true;

        // Call API to verify payment
        fetch(`/api/paywall/verify-xrp`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            payment_id: paymentRequest.id,
            tx_hash: txHash
          })
        })
          .then(response => response.json())
          .then(data => {
            // Show step 3
            step2.style.display = 'none';
            step3.style.display = 'block';

            if (data.verified) {
              // Show success message
              document.getElementById('success-message').style.display = 'block';
              document.getElementById('continue-btn').style.display = 'inline-flex';
            } else {
              // Show error message
              document.getElementById('error-message').style.display = 'block';
              document.getElementById('error-details').textContent = data.message;
              document.getElementById('try-again-btn').style.display = 'inline-flex';
            }
          })
          .catch(error => {
            console.error('Error verifying payment:', error);
            this.textContent = 'Verify Payment';
            this.disabled = false;
            alert('Error verifying payment. Please try again.');
          });
      });

      // Back button
      backBtn.addEventListener('click', function () {
        step2.style.display = 'none';
        step1.style.display = 'block';
        createPaymentBtn.textContent = 'Create Payment Request';
        createPaymentBtn.disabled = false;
      });

      // Try again button
      tryAgainBtn.addEventListener('click', function () {
        step3.style.display = 'none';
        step1.style.display = 'block';
        createPaymentBtn.textContent = 'Create Payment Request';
        createPaymentBtn.disabled = false;
        document.getElementById('success-message').style.display = 'none';
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('continue-btn').style.display = 'none';
        document.getElementById('try-again-btn').style.display = 'none';
      });
    });
  </script>
</body>

</html>
